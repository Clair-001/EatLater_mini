# 实施计划: 冲动饮食干预

## 概述

本实施计划将 EatLater 微信小程序的设计转换为一系列增量开发任务。每个任务都建立在前面的任务基础上，最终形成一个完整的功能小程序。使用微信小程序框架和 JavaScript 实现。

## 任务

- [x] 1. 设置项目结构和核心接口
  - 创建核心数据类和接口文件（FoodInput, InterventionContent, InterventionState）
  - 设置测试框架（Jest）
  - 配置项目目录结构
  - _需求: 5.4_

- [x] 2. 实现数据层组件
  - [x] 2.1 创建图片库管理器
    - 实现 ImageLibrary 类
    - 配置食物到图片的映射关系
    - 添加默认图片回退逻辑
    - 创建图片资源文件夹和示例图片
    - _需求: 2.1, 2.3_

  - [ ]* 2.2 为图片库编写属性测试
    - **属性 2: 输入验证和图片选择**
    - **属性 3: 默认图片回退**
    - **验证需求: 需求 2.1, 2.3**

  - [x] 2.3 创建文案库管理器
    - 实现 TextLibrary 类
    - 配置暂停引导文案集合
    - 实现随机文案选择逻辑
    - _需求: 3.2_

  - [ ]* 2.4 为文案库编写属性测试
    - **属性 5: 文案选择有效性**
    - **验证需求: 需求 3.2**

- [x] 3. 实现数据仓库层
  - [x] 3.1 创建 InterventionRepository
    - 整合图片库和文案库
    - 实现 getInterventionContent 方法
    - 配置快捷选择食物列表
    - _需求: 1.3, 2.1, 3.1_

  - [ ]* 3.2 为数据仓库编写单元测试
    - 测试内容生成的正确性
    - 测试快捷食物列表的完整性
    - _需求: 1.3, 2.1, 3.1_

- [x] 4. 检查点 - 确保数据层测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 5. 实现 ViewModel 层
  - [x] 5.1 创建 InterventionViewModel
    - 实现状态管理（InterventionState）
    - 处理用户输入验证逻辑
    - 连接数据仓库和 UI 层
    - _需求: 1.5, 4.4_

  - [ ]* 5.2 为 ViewModel 编写属性测试
    - **属性 6: 用户流程自由退出**
    - **属性 7: 会话数据清理**
    - **验证需求: 需求 4.4, 4.5**

- [x] 6. 重构主页面 UI 组件
  - [x] 6.1 重新设计 index.vue 主界面
    - 替换默认模板为 EatLater 界面
    - 添加食物输入框和快捷按钮
    - 配置图片显示区域和文案显示区域
    - 更新页面标题和样式
    - _需求: 1.1, 1.3_

  - [x] 6.2 实现主页面交互逻辑
    - 设置 MVVM 数据绑定
    - 处理用户输入事件
    - 管理界面状态转换
    - 连接 ViewModel 层
    - _需求: 1.2, 1.4, 3.1_

  - [ ]* 6.3 为 UI 组件编写属性测试
    - **属性 1: 快捷按钮输入填充**
    - **属性 4: UI组件同步显示**
    - **验证需求: 需求 1.4, 3.1**

- [x] 7. 实现核心交互逻辑
  - [x] 7.1 实现食物输入处理
    - 处理文本输入和快捷按钮点击
    - 实现输入验证和错误处理
    - 触发干预内容生成
    - _需求: 1.2, 1.4, 1.5_

  - [x] 7.2 实现干预内容显示
    - 显示反差视觉图片
    - 同步显示暂停引导文案
    - 提供退出选项
    - _需求: 2.1, 3.1, 4.1_

  - [ ]* 7.3 为交互逻辑编写单元测试
    - 测试输入处理的边界情况
    - 测试错误处理机制
    - _需求: 1.2, 1.4, 1.5_

- [x] 8. 优化小程序配置和性能
  - [x] 8.1 更新小程序配置文件
    - 更新 manifest.json 中的应用信息
    - 配置 pages.json 的页面标题和样式
    - 优化启动性能配置
    - _需求: 5.1, 5.2_

  - [x] 8.2 实现后台恢复功能
    - 在 App.vue 中处理小程序生命周期
    - 保持用户状态
    - 快速恢复到主界面
    - _需求: 5.3_

  - [ ]* 8.3 为性能相关功能编写属性测试
    - **属性 8: 应用性能响应**
    - **验证需求: 需求 5.1, 5.3**

- [x] 9. 实现退出和清理逻辑
  - [x] 9.1 实现自然退出功能
    - 添加退出按钮和手势
    - 确保无强制后续操作
    - 实现直接小程序关闭
    - _需求: 4.1, 4.2, 4.3_

  - [x] 9.2 实现会话数据清理
    - 清除临时输入数据
    - 重置应用状态
    - 准备下次使用
    - _需求: 4.5_

  - [ ]* 9.3 为退出逻辑编写单元测试
    - 测试退出流程的完整性
    - 验证数据清理的彻底性
    - _需求: 4.1, 4.2, 4.3, 4.5_

- [-] 10. 集成和最终测试
  - [x] 10.1 组件集成和连接
    - 连接所有 MVVM 组件
    - 确保数据流正确
    - 验证端到端功能
    - _需求: 1.1-5.5_

  - [ ]* 10.2 编写集成测试
    - 测试完整的用户流程
    - 验证所有需求的实现
    - _需求: 1.1-5.5_

- [x] 11. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

- [x] 12. 实现会话存档功能
  - [x] 12.1 创建会话存档管理器
    - 实现 SessionArchiveStorage 类
    - 配置会话级内存存储
    - 实现卡片添加和检索逻辑
    - 设置最大存档数量限制（5张卡片）
    - _需求: 6.1, 6.5_

  - [x] 12.2 创建存档卡片数据模型
    - 实现 ArchiveCard 类
    - 添加卡片ID生成和缩略图处理
    - 配置卡片元数据管理
    - _需求: 6.1_

  - [ ]* 12.3 为存档功能编写属性测试
    - **属性 10: 会话存档卡片创建**
    - **属性 11: 会话卡片历史记录完整性**
    - **属性 14: 会话数据临时性**
    - **验证需求: 需求 6.1, 6.3, 6.5**

- [x] 13. 实现卡片动画和交互
  - [x] 13.1 创建卡片管理器
    - 实现 CardManager 类
    - 配置卡片创建和动画逻辑
    - 实现卡片到堆叠的动画效果
    - _需求: 6.2_

  - [x] 13.2 实现卡片聚焦和滚动
    - 添加卡片点击聚焦功能
    - 实现水平滚动卡片堆叠
    - 配置滚动惯性和回弹效果
    - _需求: 6.4_

  - [ ]* 13.3 为卡片交互编写属性测试
    - **属性 12: 卡片动画流畅性**
    - **验证需求: 需求 6.2**

- [x] 14. 重设计UI界面和导航
  - [x] 14.1 更新主屏幕UI设计
    - 应用柔和冷色调配色方案
    - 实现极简主义布局设计
    - 添加大量留白和微妙阴影
    - 更新输入框和按钮样式
    - _需求: 8.1, 8.2, 8.3_

  - [x] 14.2 实现存档屏幕UI
    - 设计大图片展示区域
    - 实现底部卡片堆叠布局
    - 配置卡片缩略图显示
    - _需求: 6.3, 8.2, 8.3_

  - [x] 14.3 添加导航图标和状态管理
    - 在左上角添加返回箭头图标
    - 在右上角添加历史时钟图标
    - 实现导航图标的状态切换
    - _需求: 7.1, 7.2, 7.5_

- [ ] 15. 实现界面状态切换
  - [ ] 15.1 实现主屏幕和存档屏幕切换
    - 添加屏幕状态管理逻辑
    - 实现点击导航图标的切换功能
    - 配置界面转换动画
    - _需求: 7.3, 7.4_

  - [ ] 15.2 集成存档功能到主流程
    - 在干预内容显示后自动创建存档卡片
    - 实现向下滑动触发存档动画
    - 连接存档管理器和UI组件
    - _需求: 6.1, 6.2_

  - [ ]* 15.3 为导航功能编写属性测试
    - **属性 13: 导航状态一致性**
    - **验证需求: 需求 7.5**

- [ ] 16. 更新数据仓库以支持存档
  - [ ] 16.1 扩展 InterventionRepository
    - 添加存档内容生成方法
    - 集成会话存档存储
    - 实现存档历史检索功能
    - _需求: 6.1, 6.3_

  - [ ] 16.2 更新 ViewModel 支持存档
    - 在 InterventionViewModel 中添加存档逻辑
    - 实现卡片创建和管理方法
    - 添加界面状态切换控制
    - _需求: 6.1, 7.3, 7.4_

- [ ] 17. 优化动画性能和用户体验
  - [ ] 17.1 实现流畅的卡片动画
    - 配置CSS动画和过渡效果
    - 优化动画性能，确保不超过800毫秒
    - 实现动画的缓动函数
    - _需求: 8.4_

  - [ ] 17.2 添加手势交互支持
    - 实现向下滑动触发存档
    - 添加水平滑动浏览卡片
    - 配置手势识别和响应
    - _需求: 6.2_

- [ ] 18. 会话数据清理和退出处理
  - [ ] 18.1 更新退出逻辑
    - 在应用退出时清除所有会话存档
    - 确保内存中的卡片数据被完全清理
    - 更新 App.vue 的生命周期处理
    - _需求: 6.5, 4.5_

  - [ ] 18.2 实现会话重置功能
    - 在新会话开始时清理旧数据
    - 重置存档计数器和状态
    - 确保每次启动都是干净状态
    - _需求: 6.5_

- [ ] 19. 集成测试和最终验证
  - [ ] 19.1 端到端功能测试
    - 测试完整的存档流程
    - 验证UI切换和导航功能
    - 确保动画流畅性和性能
    - _需求: 6.1-8.5_

  - [ ]* 19.2 编写综合集成测试
    - 测试所有新功能的集成
    - 验证会话数据的临时性
    - 测试UI设计的一致性
    - _需求: 6.1-8.5_

- [ ] 20. 最终检查点 - 新功能验证
  - 确保所有新功能正常工作，UI设计符合要求，如有问题请询问用户

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以实现更快的 MVP
- 每个任务都引用了具体的需求以确保可追溯性
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证特定示例和边界情况
- 新增的存档功能使用会话级存储，退出应用后数据自动清除
- UI重设计采用极简主义风格和柔和冷色调配色
- 所有动画效果应确保流畅性，不超过800毫秒
- 存档功能最多保留5张卡片，超出时自动清理最旧的卡片