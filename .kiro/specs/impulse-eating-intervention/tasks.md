# 实施计划: 冲动饮食干预

## 概述

本实施计划将 EatLater 微信小程序的设计转换为一系列增量开发任务。每个任务都建立在前面的任务基础上，最终形成一个完整的功能小程序。使用微信小程序框架和 JavaScript 实现。

## 任务

- [x] 1. 设置项目结构和核心接口
  - 创建核心数据类和接口文件（FoodInput, InterventionContent, InterventionState）
  - 设置测试框架（Jest）
  - 配置项目目录结构
  - _需求: 5.4_

- [x] 2. 实现数据层组件
  - [x] 2.1 创建图片库管理器
    - 实现 ImageLibrary 类
    - 配置食物到图片的映射关系
    - 添加默认图片回退逻辑
    - 创建图片资源文件夹和示例图片
    - _需求: 2.1, 2.3_

  - [ ]* 2.2 为图片库编写属性测试
    - **属性 2: 输入验证和图片选择**
    - **属性 3: 默认图片回退**
    - **验证需求: 需求 2.1, 2.3**

  - [x] 2.3 创建文案库管理器
    - 实现 TextLibrary 类
    - 配置暂停引导文案集合
    - 实现随机文案选择逻辑
    - _需求: 3.2_

  - [ ]* 2.4 为文案库编写属性测试
    - **属性 5: 文案选择有效性**
    - **验证需求: 需求 3.2**

- [x] 3. 实现数据仓库层
  - [x] 3.1 创建 InterventionRepository
    - 整合图片库和文案库
    - 实现 getInterventionContent 方法
    - 配置快捷选择食物列表
    - _需求: 1.3, 2.1, 3.1_

  - [ ]* 3.2 为数据仓库编写单元测试
    - 测试内容生成的正确性
    - 测试快捷食物列表的完整性
    - _需求: 1.3, 2.1, 3.1_

- [x] 4. 检查点 - 确保数据层测试通过
  - 确保所有测试通过，如有问题请询问用户

- [-] 5. 实现 ViewModel 层
  - [x] 5.1 创建 InterventionViewModel
    - 实现状态管理（InterventionState）
    - 处理用户输入验证逻辑
    - 连接数据仓库和 UI 层
    - _需求: 1.5, 4.4_

  - [ ]* 5.2 为 ViewModel 编写属性测试
    - **属性 6: 用户流程自由退出**
    - **属性 7: 会话数据清理**
    - **验证需求: 需求 4.4, 4.5**

- [x] 6. 重构主页面 UI 组件
  - [x] 6.1 重新设计 index.vue 主界面
    - 替换默认模板为 EatLater 界面
    - 添加食物输入框和快捷按钮
    - 配置图片显示区域和文案显示区域
    - 更新页面标题和样式
    - _需求: 1.1, 1.3_

  - [x] 6.2 实现主页面交互逻辑
    - 设置 MVVM 数据绑定
    - 处理用户输入事件
    - 管理界面状态转换
    - 连接 ViewModel 层
    - _需求: 1.2, 1.4, 3.1_

  - [ ]* 6.3 为 UI 组件编写属性测试
    - **属性 1: 快捷按钮输入填充**
    - **属性 4: UI组件同步显示**
    - **验证需求: 需求 1.4, 3.1**

- [x] 7. 实现核心交互逻辑
  - [x] 7.1 实现食物输入处理
    - 处理文本输入和快捷按钮点击
    - 实现输入验证和错误处理
    - 触发干预内容生成
    - _需求: 1.2, 1.4, 1.5_

  - [x] 7.2 实现干预内容显示
    - 显示反差视觉图片
    - 同步显示暂停引导文案
    - 提供退出选项
    - _需求: 2.1, 3.1, 4.1_

  - [ ]* 7.3 为交互逻辑编写单元测试
    - 测试输入处理的边界情况
    - 测试错误处理机制
    - _需求: 1.2, 1.4, 1.5_

- [x] 8. 优化小程序配置和性能
  - [x] 8.1 更新小程序配置文件
    - 更新 manifest.json 中的应用信息
    - 配置 pages.json 的页面标题和样式
    - 优化启动性能配置
    - _需求: 5.1, 5.2_

  - [x] 8.2 实现后台恢复功能
    - 在 App.vue 中处理小程序生命周期
    - 保持用户状态
    - 快速恢复到主界面
    - _需求: 5.3_

  - [ ]* 8.3 为性能相关功能编写属性测试
    - **属性 8: 应用性能响应**
    - **验证需求: 需求 5.1, 5.3**

- [ ] 9. 实现离线功能支持
  - [ ] 9.1 配置本地资源管理
    - 确保所有图片和文案本地存储
    - 实现离线模式检测
    - 优化本地资源访问
    - _需求: 5.5_

  - [ ]* 9.2 为离线功能编写属性测试
    - **属性 9: 离线功能完整性**
    - **验证需求: 需求 5.5**

- [ ] 10. 实现退出和清理逻辑
  - [ ] 10.1 实现自然退出功能
    - 添加退出按钮和手势
    - 确保无强制后续操作
    - 实现直接小程序关闭
    - _需求: 4.1, 4.2, 4.3_

  - [ ] 10.2 实现会话数据清理
    - 清除临时输入数据
    - 重置应用状态
    - 准备下次使用
    - _需求: 4.5_

  - [ ]* 10.3 为退出逻辑编写单元测试
    - 测试退出流程的完整性
    - 验证数据清理的彻底性
    - _需求: 4.1, 4.2, 4.3, 4.5_

- [ ] 11. 集成和最终测试
  - [ ] 11.1 组件集成和连接
    - 连接所有 MVVM 组件
    - 确保数据流正确
    - 验证端到端功能
    - _需求: 1.1-5.5_

  - [ ]* 11.2 编写集成测试
    - 测试完整的用户流程
    - 验证所有需求的实现
    - _需求: 1.1-5.5_

- [ ] 12. 最终检查点 - 确保所有测试通过
  - 确保所有测试通过，如有问题请询问用户

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以实现更快的 MVP
- 每个任务都引用了具体的需求以确保可追溯性
- 检查点确保增量验证
- 属性测试验证通用正确性属性
- 单元测试验证特定示例和边界情况
- 当前项目只有基础的 uni-app 结构，需要从头开始实现 EatLater 功能