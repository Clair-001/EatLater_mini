{"version":3,"file":"ImageLibrary.js","sources":["interfaces/ImageLibrary.js"],"sourcesContent":["/**\r\n * 图片库接口\r\n * 定义图片库的核心功能\r\n */\r\nexport class ImageLibrary {\r\n    constructor() {\r\n        this.imageMapping = new Map();\r\n        this.defaultImagePath = 'https://ob-assets-open.oss-cn-shanghai.aliyuncs.com/img/202601211107127.jpg';\r\n    }\r\n\r\n    /**\r\n     * 根据食物名称获取对应图片\r\n     * @param {string} foodName - 食物名称\r\n     * @returns {string} 图片路径\r\n     */\r\n    getImageForFood(foodName) {\r\n        if (!foodName || typeof foodName !== 'string') {\r\n            return this.getDefaultImage();\r\n        }\r\n\r\n        const cleanName = foodName.trim().toLowerCase();\r\n\r\n        // 遍历映射查找匹配的关键词\r\n        for (const [keywords, imagePath] of this.imageMapping) {\r\n            if (keywords.some(keyword => cleanName.includes(keyword.toLowerCase()))) {\r\n                return imagePath;\r\n            }\r\n        }\r\n\r\n        return this.getDefaultImage();\r\n    }\r\n\r\n    /**\r\n     * 获取默认图片\r\n     * @returns {string} 默认图片路径\r\n     */\r\n    getDefaultImage() {\r\n        return this.defaultImagePath;\r\n    }\r\n\r\n    /**\r\n     * 检查指定食物是否有对应图片\r\n     * @param {string} foodName - 食物名称\r\n     * @returns {boolean} 是否有对应图片\r\n     */\r\n    isImageAvailable(foodName) {\r\n        if (!foodName || typeof foodName !== 'string') {\r\n            return false;\r\n        }\r\n\r\n        const cleanName = foodName.trim().toLowerCase();\r\n\r\n        for (const [keywords] of this.imageMapping) {\r\n            if (keywords.some(keyword => cleanName.includes(keyword.toLowerCase()))) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * 添加图片映射\r\n     * @param {Array<string>} keywords - 关键词数组\r\n     * @param {string} imagePath - 图片路径\r\n     */\r\n    addImageMapping(keywords, imagePath) {\r\n        this.imageMapping.set(keywords, imagePath);\r\n    }\r\n\r\n    /**\r\n     * 初始化默认图片映射\r\n     */\r\n    initializeDefaultMappings() {\r\n        // 快餐类\r\n        this.addImageMapping(\r\n            ['披萨', 'pizza', '比萨'],\r\n            'https://ob-assets-open.oss-cn-shanghai.aliyuncs.com/img/202601211107400.jpg'\r\n        );\r\n\r\n        this.addImageMapping(\r\n            ['炸鸡', '鸡腿', '肯德基', '麦当劳', 'kfc'],\r\n            'https://ob-assets-open.oss-cn-shanghai.aliyuncs.com/img/202601211107624.jpg'\r\n        );\r\n\r\n        // 饮品类\r\n        this.addImageMapping(\r\n            ['奶茶', '珍珠奶茶', '茶饮'],\r\n            'https://ob-assets-open.oss-cn-shanghai.aliyuncs.com/img/202601211107542.jpg'\r\n        );\r\n\r\n        // 甜品类\r\n        this.addImageMapping(\r\n            ['蛋糕', 'cake', '甜品', '甜点'],\r\n            'https://ob-assets-open.oss-cn-shanghai.aliyuncs.com/img/202601211102004.jpg'\r\n        );\r\n\r\n        // 零食类\r\n        this.addImageMapping(\r\n            ['薯条', '薯片', '炸薯条'],\r\n            'https://ob-assets-open.oss-cn-shanghai.aliyuncs.com/img/202601211107751.jpg'\r\n        );\r\n    }\r\n\r\n    /**\r\n     * 清理缓存\r\n     * 清理可能存在的临时缓存数据\r\n     */\r\n    clearCache() {\r\n        try {\r\n            console.log('清理图片库缓存');\r\n\r\n            // 清理可能存在的图片缓存\r\n            const cacheKeys = [\r\n                'imageLoadCache',\r\n                'lastSelectedImage',\r\n                'imageSelectionHistory',\r\n                'recentImages'\r\n            ];\r\n\r\n            cacheKeys.forEach(key => {\r\n                try {\r\n                    if (typeof uni !== 'undefined' && uni.removeStorageSync) {\r\n                        uni.removeStorageSync(key);\r\n                    }\r\n                } catch (error) {\r\n                    console.warn(`清理图片缓存失败: ${key}`, error);\r\n                }\r\n            });\r\n\r\n            console.log('图片库缓存清理完成');\r\n\r\n        } catch (error) {\r\n            console.error('清理图片库缓存时发生错误:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 重置图片映射\r\n     */\r\n    resetMappings() {\r\n        this.imageMapping.clear();\r\n        this.initializeDefaultMappings();\r\n    }\r\n}"],"names":["uni"],"mappings":";;AAIO,MAAM,aAAa;AAAA,EACtB,cAAc;AACV,SAAK,eAAe,oBAAI;AACxB,SAAK,mBAAmB;AAAA,EAC3B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOD,gBAAgB,UAAU;AACtB,QAAI,CAAC,YAAY,OAAO,aAAa,UAAU;AAC3C,aAAO,KAAK;IACf;AAED,UAAM,YAAY,SAAS,KAAM,EAAC,YAAW;AAG7C,eAAW,CAAC,UAAU,SAAS,KAAK,KAAK,cAAc;AACnD,UAAI,SAAS,KAAK,aAAW,UAAU,SAAS,QAAQ,YAAa,CAAA,CAAC,GAAG;AACrE,eAAO;AAAA,MACV;AAAA,IACJ;AAED,WAAO,KAAK;EACf;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,kBAAkB;AACd,WAAO,KAAK;AAAA,EACf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOD,iBAAiB,UAAU;AACvB,QAAI,CAAC,YAAY,OAAO,aAAa,UAAU;AAC3C,aAAO;AAAA,IACV;AAED,UAAM,YAAY,SAAS,KAAM,EAAC,YAAW;AAE7C,eAAW,CAAC,QAAQ,KAAK,KAAK,cAAc;AACxC,UAAI,SAAS,KAAK,aAAW,UAAU,SAAS,QAAQ,YAAa,CAAA,CAAC,GAAG;AACrE,eAAO;AAAA,MACV;AAAA,IACJ;AAED,WAAO;AAAA,EACV;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOD,gBAAgB,UAAU,WAAW;AACjC,SAAK,aAAa,IAAI,UAAU,SAAS;AAAA,EAC5C;AAAA;AAAA;AAAA;AAAA,EAKD,4BAA4B;AAExB,SAAK;AAAA,MACD,CAAC,MAAM,SAAS,IAAI;AAAA,MACpB;AAAA,IACZ;AAEQ,SAAK;AAAA,MACD,CAAC,MAAM,MAAM,OAAO,OAAO,KAAK;AAAA,MAChC;AAAA,IACZ;AAGQ,SAAK;AAAA,MACD,CAAC,MAAM,QAAQ,IAAI;AAAA,MACnB;AAAA,IACZ;AAGQ,SAAK;AAAA,MACD,CAAC,MAAM,QAAQ,MAAM,IAAI;AAAA,MACzB;AAAA,IACZ;AAGQ,SAAK;AAAA,MACD,CAAC,MAAM,MAAM,KAAK;AAAA,MAClB;AAAA,IACZ;AAAA,EACK;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,aAAa;AACT,QAAI;AACAA,oBAAAA,wDAAY,SAAS;AAGrB,YAAM,YAAY;AAAA,QACd;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MAChB;AAEY,gBAAU,QAAQ,SAAO;AACrB,YAAI;AACA,cAAI,OAAOA,cAAG,UAAK,eAAeA,cAAAA,MAAI,mBAAmB;AACrDA,gCAAI,kBAAkB,GAAG;AAAA,UAC5B;AAAA,QACJ,SAAQ,OAAO;AACZA,8BAAa,MAAA,QAAA,qCAAA,aAAa,GAAG,IAAI,KAAK;AAAA,QACzC;AAAA,MACjB,CAAa;AAEDA,oBAAAA,MAAA,MAAA,OAAA,qCAAY,WAAW;AAAA,IAE1B,SAAQ,OAAO;AACZA,oBAAc,MAAA,MAAA,SAAA,qCAAA,iBAAiB,KAAK;AAAA,IACvC;AAAA,EACJ;AAAA;AAAA;AAAA;AAAA,EAKD,gBAAgB;AACZ,SAAK,aAAa;AAClB,SAAK,0BAAyB;AAAA,EACjC;AACL;;"}