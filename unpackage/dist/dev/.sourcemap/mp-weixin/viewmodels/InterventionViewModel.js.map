{"version":3,"file":"InterventionViewModel.js","sources":["viewmodels/InterventionViewModel.js"],"sourcesContent":["import { InterventionState, StateManager } from '../models/InterventionState.js';\r\nimport { InterventionRepository } from '../interfaces/InterventionRepository.js';\r\nimport { FoodInput } from '../models/FoodInput.js';\r\n\r\n/**\r\n * 干预 ViewModel 类\r\n * 连接数据仓库和 UI 层，处理业务逻辑和状态管理\r\n */\r\nexport class InterventionViewModel {\r\n    constructor() {\r\n        // 状态管理器\r\n        this.stateManager = new StateManager();\r\n\r\n        // 数据仓库\r\n        this.repository = new InterventionRepository();\r\n\r\n        // 当前干预内容\r\n        this.currentContent = null;\r\n\r\n        // 当前食物输入\r\n        this.currentFoodInput = null;\r\n\r\n        // 错误信息\r\n        this.errorMessage = '';\r\n\r\n        // 事件监听器\r\n        this.eventListeners = {\r\n            stateChanged: [],\r\n            contentReady: [],\r\n            error: [],\r\n            userExit: []\r\n        };\r\n\r\n        // 初始化\r\n        this.initialize();\r\n    }\r\n\r\n    /**\r\n     * 初始化 ViewModel\r\n     */\r\n    async initialize() {\r\n        try {\r\n            // 转换到输入准备状态\r\n            this.transitionToState(InterventionState.INPUT_READY);\r\n        } catch (error) {\r\n            this.handleError('初始化失败', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 处理用户食物输入\r\n     * @param {string} foodName - 食物名称\r\n     * @returns {Promise<boolean>} 处理是否成功\r\n     */\r\n    async handleFoodInput(foodName) {\r\n        try {\r\n            // 清除之前的错误信息\r\n            this.clearError();\r\n\r\n            // 基本输入验证\r\n            if (!foodName || typeof foodName !== 'string') {\r\n                this.setError('请输入您想吃的食物');\r\n                return false;\r\n            }\r\n\r\n            // 创建食物输入对象\r\n            const foodInput = new FoodInput(foodName);\r\n\r\n            // 验证输入\r\n            if (!this.validateFoodInput(foodInput)) {\r\n                return false;\r\n            }\r\n\r\n            // 保存当前输入\r\n            this.currentFoodInput = foodInput;\r\n\r\n            // 获取干预内容\r\n            await this.loadInterventionContent(foodInput);\r\n\r\n            return true;\r\n        } catch (error) {\r\n            this.handleError('处理食物输入失败', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 验证食物输入\r\n     * @param {FoodInput} foodInput - 食物输入对象\r\n     * @returns {boolean} 验证是否通过\r\n     */\r\n    validateFoodInput(foodInput) {\r\n        if (!foodInput || !foodInput.isValid()) {\r\n            this.setError('请输入您想吃的食物');\r\n            return false;\r\n        }\r\n\r\n        const cleanName = foodInput.getCleanName();\r\n\r\n        // 检查是否为空或只包含空白字符\r\n        if (!cleanName || cleanName.length === 0) {\r\n            this.setError('请输入您想吃的食物');\r\n            return false;\r\n        }\r\n\r\n        // 检查长度限制\r\n        if (cleanName.length > 50) {\r\n            this.setError('食物名称过长，请输入50个字符以内');\r\n            return false;\r\n        }\r\n\r\n        // 检查最小长度\r\n        if (cleanName.length < 1) {\r\n            this.setError('食物名称过短');\r\n            return false;\r\n        }\r\n\r\n        // 检查是否包含特殊字符（基本验证）\r\n        const invalidChars = /[<>\\\"'&]/;\r\n        if (invalidChars.test(cleanName)) {\r\n            this.setError('食物名称包含无效字符');\r\n            return false;\r\n        }\r\n\r\n        // 检查是否只包含数字\r\n        const onlyNumbers = /^\\d+$/;\r\n        if (onlyNumbers.test(cleanName)) {\r\n            this.setError('请输入有效的食物名称');\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * 加载干预内容\r\n     * @param {FoodInput} foodInput - 食物输入对象\r\n     */\r\n    async loadInterventionContent(foodInput) {\r\n        try {\r\n            // 获取干预内容\r\n            const content = await this.repository.getInterventionContent(foodInput);\r\n\r\n            if (!content || !content.isComplete()) {\r\n                throw new Error('获取的干预内容不完整');\r\n            }\r\n\r\n            // 验证内容的有效性\r\n            if (!content.imageResource || !content.guidanceText) {\r\n                console.warn('干预内容缺少必要信息，使用默认内容');\r\n\r\n                // 使用默认内容补充\r\n                if (!content.imageResource) {\r\n                    content.imageResource = this.repository.imageLibrary.getDefaultImage();\r\n                }\r\n                if (!content.guidanceText) {\r\n                    content.guidanceText = this.repository.textLibrary.getDefaultText();\r\n                }\r\n            }\r\n\r\n            // 保存内容\r\n            this.currentContent = content;\r\n\r\n            // 转换状态到内容显示\r\n            this.transitionToState(InterventionState.CONTENT_DISPLAYED);\r\n\r\n            // 触发内容准备事件\r\n            this.emitEvent('contentReady', content);\r\n\r\n            console.log('干预内容加载成功:', {\r\n                food: content.foodName,\r\n                hasImage: !!content.imageResource,\r\n                hasText: !!content.guidanceText\r\n            });\r\n\r\n        } catch (error) {\r\n            this.handleError('加载干预内容失败', error);\r\n\r\n            // 尝试使用默认内容\r\n            try {\r\n                const defaultContent = await this.createDefaultContent(foodInput);\r\n                this.currentContent = defaultContent;\r\n                this.transitionToState(InterventionState.CONTENT_DISPLAYED);\r\n                this.emitEvent('contentReady', defaultContent);\r\n            } catch (defaultError) {\r\n                console.error('创建默认内容也失败:', defaultError);\r\n                // 回到输入状态\r\n                this.transitionToState(InterventionState.INPUT_READY);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 创建默认干预内容\r\n     * @param {FoodInput} foodInput - 食物输入对象\r\n     * @returns {Promise<InterventionContent>} 默认干预内容\r\n     */\r\n    async createDefaultContent(foodInput) {\r\n        const { InterventionContent } = await import('../models/InterventionContent.js');\r\n\r\n        return new InterventionContent(\r\n            '/static/images/default_unappetizing.jpg',\r\n            '先缓一缓，现在不急，晚点再决定',\r\n            foodInput ? foodInput.getCleanName() : '未知食物'\r\n        );\r\n    }\r\n\r\n    /**\r\n     * 处理快捷按钮点击\r\n     * @param {string} foodName - 快捷按钮对应的食物名称\r\n     * @returns {Promise<boolean>} 处理是否成功\r\n     */\r\n    async handleQuickSelectFood(foodName) {\r\n        try {\r\n            // 验证快捷选择的食物名称\r\n            if (!foodName || typeof foodName !== 'string') {\r\n                this.setError('无效的食物选择');\r\n                return false;\r\n            }\r\n\r\n            const cleanFoodName = foodName.trim();\r\n            if (!cleanFoodName) {\r\n                this.setError('无效的食物选择');\r\n                return false;\r\n            }\r\n\r\n            // 调用通用的食物输入处理方法\r\n            return await this.handleFoodInput(cleanFoodName);\r\n        } catch (error) {\r\n            this.handleError('处理快捷选择失败', error);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取快捷选择食物列表\r\n     * @returns {Array<string>} 快捷选择食物列表\r\n     */\r\n    getQuickSelectFoods() {\r\n        return this.repository.getQuickSelectFoods();\r\n    }\r\n\r\n    /**\r\n     * 处理用户退出\r\n     */\r\n    handleExit() {\r\n        try {\r\n            console.log('用户选择退出干预');\r\n\r\n            // 记录退出事件（用于统计，不强制用户）\r\n            const exitData = {\r\n                exitTime: Date.now(),\r\n                foodName: this.currentFoodInput ? this.currentFoodInput.getCleanName() : null,\r\n                stateAtExit: this.getCurrentState(),\r\n                sessionDuration: this.calculateSessionDuration()\r\n            };\r\n\r\n            // 清理会话数据\r\n            this.clearSessionData();\r\n\r\n            // 不转换到完成状态，而是直接准备退出\r\n            // 这样避免显示额外的界面或推荐\r\n\r\n            // 触发退出事件\r\n            this.emitEvent('userExit', exitData);\r\n\r\n            console.log('退出处理完成，准备关闭应用');\r\n\r\n        } catch (error) {\r\n            this.handleError('退出处理失败', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 计算会话持续时间\r\n     * @returns {number} 会话持续时间（毫秒）\r\n     */\r\n    calculateSessionDuration() {\r\n        if (this.currentFoodInput && this.currentFoodInput.timestamp) {\r\n            return Date.now() - this.currentFoodInput.timestamp;\r\n        }\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * 重置应用状态\r\n     */\r\n    reset() {\r\n        try {\r\n            console.log('重置应用状态');\r\n\r\n            // 深度清理会话数据\r\n            this.deepCleanSessionData();\r\n\r\n            // 准备下次使用\r\n            this.prepareForNextUse();\r\n\r\n            // 确保状态正确转换到输入准备状态\r\n            this.transitionToState(InterventionState.INPUT_READY);\r\n\r\n            console.log('应用状态重置完成，当前状态:', this.getCurrentState());\r\n\r\n        } catch (error) {\r\n            this.handleError('重置失败', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清理会话数据\r\n     * 清除临时输入数据、重置应用状态、准备下次使用\r\n     */\r\n    clearSessionData() {\r\n        try {\r\n            console.log('开始清理会话数据');\r\n\r\n            // 清理当前内容\r\n            this.currentContent = null;\r\n\r\n            // 清理当前食物输入\r\n            this.currentFoodInput = null;\r\n\r\n            // 清理错误信息\r\n            this.clearError();\r\n\r\n            // 清理本地存储中的临时数据\r\n            this.clearTemporaryStorage();\r\n\r\n            // 重置状态管理器\r\n            if (this.stateManager) {\r\n                this.stateManager.reset();\r\n            }\r\n\r\n            // 清理事件监听器中的临时数据\r\n            this.clearEventListenerData();\r\n\r\n            console.log('会话数据清理完成');\r\n\r\n        } catch (error) {\r\n            console.error('清理会话数据时发生错误:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清理临时存储数据\r\n     */\r\n    clearTemporaryStorage() {\r\n        try {\r\n            // 定义需要清理的临时存储键\r\n            const temporaryKeys = [\r\n                'currentSession',\r\n                'tempFoodInput',\r\n                'lastInterventionContent',\r\n                'sessionStartTime',\r\n                'userInputHistory',\r\n                'tempImageCache',\r\n                'tempTextCache'\r\n            ];\r\n\r\n            // 清理每个临时存储项\r\n            temporaryKeys.forEach(key => {\r\n                try {\r\n                    if (typeof uni !== 'undefined' && uni.removeStorageSync) {\r\n                        uni.removeStorageSync(key);\r\n                        console.log(`已清理存储项: ${key}`);\r\n                    }\r\n                } catch (error) {\r\n                    console.warn(`清理存储项失败: ${key}`, error);\r\n                }\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error('清理临时存储时发生错误:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清理事件监听器中的临时数据\r\n     */\r\n    clearEventListenerData() {\r\n        try {\r\n            // 清理事件监听器数组中的临时引用\r\n            Object.keys(this.eventListeners).forEach(eventType => {\r\n                // 保留事件监听器数组结构，但可以清理其中的临时数据\r\n                // 这里不清理监听器本身，因为它们可能在下次使用时需要\r\n            });\r\n\r\n        } catch (error) {\r\n            console.error('清理事件监听器数据时发生错误:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 深度清理所有数据\r\n     * 用于应用完全重置或退出时\r\n     */\r\n    deepCleanSessionData() {\r\n        try {\r\n            console.log('开始深度清理会话数据');\r\n\r\n            // 执行标准清理\r\n            this.clearSessionData();\r\n\r\n            // 清理数据仓库缓存\r\n            if (this.repository) {\r\n                if (typeof this.repository.clearCache === 'function') {\r\n                    this.repository.clearCache();\r\n                }\r\n            }\r\n\r\n            // 清理所有事件监听器\r\n            this.removeAllEventListeners();\r\n\r\n            // 清理更多的存储项\r\n            this.clearAllTemporaryStorage();\r\n\r\n            console.log('深度清理完成');\r\n\r\n        } catch (error) {\r\n            console.error('深度清理时发生错误:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 清理所有临时存储\r\n     */\r\n    clearAllTemporaryStorage() {\r\n        try {\r\n            // 获取所有存储键\r\n            if (typeof uni !== 'undefined' && uni.getStorageInfoSync) {\r\n                const storageInfo = uni.getStorageInfoSync();\r\n                const allKeys = storageInfo.keys || [];\r\n\r\n                // 定义需要保留的持久化数据键\r\n                const persistentKeys = [\r\n                    'userPreferences',\r\n                    'appVersion',\r\n                    'installTime',\r\n                    'userSettings'\r\n                ];\r\n\r\n                // 清理所有非持久化数据\r\n                allKeys.forEach(key => {\r\n                    if (!persistentKeys.includes(key)) {\r\n                        try {\r\n                            uni.removeStorageSync(key);\r\n                            console.log(`已清理存储项: ${key}`);\r\n                        } catch (error) {\r\n                            console.warn(`清理存储项失败: ${key}`, error);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error('清理所有临时存储时发生错误:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 移除所有事件监听器\r\n     */\r\n    removeAllEventListeners() {\r\n        try {\r\n            Object.keys(this.eventListeners).forEach(eventType => {\r\n                this.eventListeners[eventType] = [];\r\n            });\r\n            console.log('所有事件监听器已清理');\r\n        } catch (error) {\r\n            console.error('清理事件监听器时发生错误:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 准备下次使用\r\n     * 重置必要的状态，但保留配置\r\n     */\r\n    prepareForNextUse() {\r\n        try {\r\n            console.log('准备应用下次使用');\r\n\r\n            // 清理会话数据\r\n            this.clearSessionData();\r\n\r\n            // 重新初始化状态管理器\r\n            if (this.stateManager) {\r\n                this.stateManager.reset();\r\n            }\r\n\r\n            // 重置到初始状态\r\n            this.transitionToState(InterventionState.INPUT_READY);\r\n\r\n            // 预加载必要资源（如果需要）\r\n            this.preloadEssentialResources();\r\n\r\n            console.log('应用已准备好下次使用，当前状态:', this.getCurrentState());\r\n\r\n        } catch (error) {\r\n            console.error('准备下次使用时发生错误:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 预加载必要资源\r\n     */\r\n    preloadEssentialResources() {\r\n        try {\r\n            // 这里可以预加载一些关键资源\r\n            // 比如默认图片、常用文案等\r\n\r\n            // 预加载快捷选择食物列表\r\n            if (this.repository) {\r\n                this.repository.getQuickSelectFoods();\r\n            }\r\n\r\n        } catch (error) {\r\n            console.error('预加载资源时发生错误:', error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 转换状态\r\n     * @param {string} newState - 新状态\r\n     */\r\n    transitionToState(newState) {\r\n        const currentState = this.stateManager.getCurrentState();\r\n\r\n        // 如果已经是目标状态，则不需要转换\r\n        if (currentState === newState) {\r\n            console.log(`已经处于目标状态: ${newState}`);\r\n            return true;\r\n        }\r\n\r\n        const success = this.stateManager.transitionTo(newState);\r\n        if (success) {\r\n            this.emitEvent('stateChanged', {\r\n                oldState: this.stateManager.stateHistory[this.stateManager.stateHistory.length - 2],\r\n                newState: newState\r\n            });\r\n        } else {\r\n            console.warn(`无效的状态转换: ${currentState} -> ${newState}`);\r\n        }\r\n        return success;\r\n    }\r\n\r\n    /**\r\n     * 获取当前状态\r\n     * @returns {string} 当前状态\r\n     */\r\n    getCurrentState() {\r\n        return this.stateManager.getCurrentState();\r\n    }\r\n\r\n    /**\r\n     * 获取当前干预内容\r\n     * @returns {InterventionContent|null} 当前干预内容\r\n     */\r\n    getCurrentContent() {\r\n        return this.currentContent;\r\n    }\r\n\r\n    /**\r\n     * 获取当前食物输入\r\n     * @returns {FoodInput|null} 当前食物输入\r\n     */\r\n    getCurrentFoodInput() {\r\n        return this.currentFoodInput;\r\n    }\r\n\r\n    /**\r\n     * 检查是否有错误\r\n     * @returns {boolean} 是否有错误\r\n     */\r\n    hasError() {\r\n        return !!this.errorMessage;\r\n    }\r\n\r\n    /**\r\n     * 获取错误信息\r\n     * @returns {string} 错误信息\r\n     */\r\n    getErrorMessage() {\r\n        return this.errorMessage;\r\n    }\r\n\r\n    /**\r\n     * 设置错误信息\r\n     * @param {string} message - 错误信息\r\n     */\r\n    setError(message) {\r\n        this.errorMessage = message;\r\n        this.emitEvent('error', message);\r\n    }\r\n\r\n    /**\r\n     * 清除错误信息\r\n     */\r\n    clearError() {\r\n        this.errorMessage = '';\r\n    }\r\n\r\n    /**\r\n     * 处理错误\r\n     * @param {string} context - 错误上下文\r\n     * @param {Error} error - 错误对象\r\n     */\r\n    handleError(context, error) {\r\n        console.error(`${context}:`, error);\r\n        this.setError(error.message || '发生未知错误');\r\n    }\r\n\r\n    /**\r\n     * 添加事件监听器\r\n     * @param {string} eventType - 事件类型\r\n     * @param {Function} listener - 监听器函数\r\n     */\r\n    addEventListener(eventType, listener) {\r\n        if (this.eventListeners[eventType]) {\r\n            this.eventListeners[eventType].push(listener);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 移除事件监听器\r\n     * @param {string} eventType - 事件类型\r\n     * @param {Function} listener - 监听器函数\r\n     */\r\n    removeEventListener(eventType, listener) {\r\n        if (this.eventListeners[eventType]) {\r\n            const index = this.eventListeners[eventType].indexOf(listener);\r\n            if (index > -1) {\r\n                this.eventListeners[eventType].splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 触发事件\r\n     * @param {string} eventType - 事件类型\r\n     * @param {*} data - 事件数据\r\n     */\r\n    emitEvent(eventType, data) {\r\n        if (this.eventListeners[eventType]) {\r\n            this.eventListeners[eventType].forEach(listener => {\r\n                try {\r\n                    listener(data);\r\n                } catch (error) {\r\n                    console.error(`事件监听器执行失败 (${eventType}):`, error);\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 获取 ViewModel 状态信息（用于调试）\r\n     * @returns {Object} 状态信息\r\n     */\r\n    getDebugInfo() {\r\n        return {\r\n            currentState: this.getCurrentState(),\r\n            hasContent: !!this.currentContent,\r\n            hasFoodInput: !!this.currentFoodInput,\r\n            hasError: this.hasError(),\r\n            errorMessage: this.errorMessage,\r\n            quickSelectFoods: this.getQuickSelectFoods()\r\n        };\r\n    }\r\n}"],"names":["StateManager","InterventionRepository","InterventionState","FoodInput","uni"],"mappings":"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"}